<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Ceri Wood Photography</title>
    <meta name="description" content="Portfolio of music & events photographer Ceri Wood">
    <link rel="canonical" href="http://ceriwood.com/photography" />
    
    <meta http-equiv="cleartype" content="on">
    <meta name="viewport" content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0'>

    <!-- Schema.org markup for Google --> 
    <meta itemprop="name" content="Ceri Wood" /> 
    <meta itemprop="description" content="Portfolio of music & events photographer Ceri Wood" /> 
    <meta itemprop="image" content="http://www.ceriwood.com/img/ceriwood-logo.jpg" />

    <!-- Twitter Card data --> 
    <meta property="twitter:card" content="summary" />
    <meta property="twitter:title" content="Ceri Wood" /> 
    <meta property="twitter:description" content="Portfolio of music & events photographer Ceri Wood" /> 
    <meta property="twitter:creator" content="@rainbowlemon" />
    <meta property="twitter:image" content="http://www.ceriwood.com/img/ceriwood-logo.jpg" />
    <meta property="twitter:url" content="http://www.ceriwood.com/photography" />
        
    <!-- Open Graph data --> 
    <meta property="og:title" content="Ceri Wood" />
    <meta property="og:url" content="http://www.ceriwood.com/photography" />
    <meta property="og:image" content="http://www.ceriwood.com/img/ceriwood-logo.jpg" />
    <meta property="og:description" content="Portfolio of music & events photographer Ceri Wood" /> 
    <meta property="og:site_name" content="ceriwood" /> 
    <meta property="article:published_time" content="2014-10-22T00:00:00+01:00" /> 
    <meta property="article:modified_time" content="2015-11-26T00:00:00+01:00" />
    
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300,400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    
    <script src="/modernizr-custom.js"></script>
</head>
<body>

<nav id="page-nav" role="navigation">
    <header id="page-header" role="banner">
        <h1><a href="/">
            <img itemprop="image" src="/img/cw-logo-white.svg" width="280" alt="Ceri Wood" title="Ceri Wood">
        </a></h1>
    </header>
    
    <ul id="album-list"></ul>
    
    <a href="#about">About</a>
    <a href="#contact">Contact</a>
</nav>


<main role="main">
    <div id="photo-container"></div>
</main>
    
<footer id="page-footer">
    
</footer>
    
<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script>
    // --- Main app
    function App(){
        this.apiKey = 'c6dc8581507548e535e52e8cdb1dfde6';
        this.userId = '31363701@N00';
        this.photoPrefix = 'CWP-';
        this.photosets = [];
    };
    
    App.prototype = {
        init: function(){
            this.bindEvents();
            
            this.getPhotosets();
        },
        
        bindEvents: function(){
            
        },
        
        getPhotosets: function(){
            var xhr = $.get('https://api.flickr.com/services/rest/?method=flickr.photosets.getList&api_key=' + this.apiKey + '&user_id=' + this.userId);
            
            var self = this;
            
            xhr.done(function(data){
                $(data).find('photoset').each(function(){
                    var $this = $(this);
                    var title = $this.find('title').text();

                    if (title.indexOf(self.photoPrefix) === -1) return;

                    self.photosets.push({
                        title: title.substr(4),
                        id: this.id
                    });
                });
                
                self.setAlbumList();
                
                var hash = window.location.hash;
                if (hash === ''){
                    self.getPhotos({ id: self.photosets[0].id });
                    $('#album-list').first('li').find('a').addClass('active');
                } else if (hash === 'about') {
                    // @TODO - Show about page
                } else if (hash === 'contact') {
                    // @TODO - Show contact page
                } else {
                    var photosetToSelect = self.photosets.filter(function(obj){
                        return obj.title.toLowerCase() === hash.substr(1).toLowerCase();
                    });
                    
                    if (photosetToSelect !== void 0) {
                        self.getPhotos(photosetToSelect[0]);
                    }
                }
            });
            
            xhr.fail(function(err){
                console.error(err);
            });
        },
        
        setAlbumList: function(){
            this.photosets.forEach(function(obj){
                $('#album-list').append('<li><a href="#' + obj.title + '" data-album-id="' + obj.id + '">' + obj.title + '</a></li>');
            });
        },
        
        getPhotos: function(obj){
            var xhr = $.get('https://api.flickr.com/services/rest/' +
                  '?method=flickr.photosets.getPhotos' +
                  '&api_key=' + this.apiKey + 
                  '&user_id=' + this.userId + 
                  '&photoset_id=' + obj.id + 
                  '&extras=description');
            var photos = [];
            var self = this;
            
            xhr.done(function(data){
                $(data).find('photo').each(function(i, obj){
                    var url = 'https://farm' + obj.getAttribute('farm') + 
                              '.staticflickr.com/' + obj.getAttribute('server') + 
                              '/' + obj.getAttribute('id') + 
                              '_' + obj.getAttribute('secret') + '_c.jpg';
                    
                    photos.push({
                        url: url,
                        title: obj.getAttribute('title'),
                        description: obj.getAttribute('description')
                    });
                });
                
                self.renderPhotos(photos);
            });
            
            xhr.fail(function(err){
                console.error(err);
            });
        },
        
        renderPhotos: function(photos){
            $.each(photos, function(i, obj){
                $('#photo-container').append('<img src="' + obj.url + '" alt="' + (obj.description || '') + '" title="'+ (obj.title || '') + '" />')
            });
        }
    };
    
    var app = new App();
    $(document).ready(function(){
        app.init();
    });
    
</script>

</body>
</html>